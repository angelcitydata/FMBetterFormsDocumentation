export const metadata = {
  title: 'Dropdown Component',
  description:
    'A flexible dropdown menu component for FM BetterForms with support for various item types, state management, and customizable actions.',
}

# Dropdown Component

The Dropdown component is a versatile menu element that displays a list of options, actions, or controls in your FM BetterForms application. It supports multiple item types including standard items, checkboxes, radios, groups, and separators, with full keyboard navigation and accessibility features. {{ className: 'lead' }}

    This component manages its own open/close state, handles item selection
    through the named action system, and provides flexible configuration options
    for building rich, interactive menus.

---

## Component Properties

### Display & Layout Properties

<Properties>
  <Property name="label" type="string">
    The text displayed on the dropdown trigger button. Default is "Open Menu".
  </Property>
  <Property name="icon" type="string">
    Font Awesome icon class displayed to the left of the label on the trigger
    button (e.g., "fa-bars", "fa-ellipsis-vertical").
  </Property>
  <Property name="items" type="array">
    Array of menu items to display in the dropdown. Each item can be a standard
    item, checkbox, radio, group, or separator. See Item Types Guide below for
    detailed configuration options.
  </Property>
  <Property name="align" type="string">
    Controls the horizontal alignment of the dropdown menu relative to the
    trigger button. **Supported values:**
    
    - `"start"` - Aligns menu to the left edge of the button
    - `"end"` - Aligns menu to the right edge of the button (default)
    - `"center"` - Centers menu relative to the button

    Default is "end".

  </Property>
  <Property name="fullWidth" type="boolean">
    When true, the dropdown trigger button expands to fill the full width of
    its container. Default is false.
  </Property>
  <Property name="idPrefix" type="string">
    Prefix used for generating unique element IDs. Useful when you have
    multiple dropdowns on the same page. Default is "dd".
  </Property>
</Properties>

### State Management Properties

<Properties>
  <Property name="stateKey" type="string">
    The model key used to track the dropdown's open/closed state. If not
    provided, defaults to `dropdownState_` + `modelKey` (or "default" if no
    modelKey). The component automatically manages this state.
  </Property>
  <Property name="modelKey" type="string">
    The model key used for radio items to store the selected value. Only applies
    when using radio-type items. Default is "dropdownRadio".
  </Property>
  <Property name="radioModelKey" type="string">
    Alternative property name for specifying the radio model key. Functionally
    equivalent to `modelKey`.
  </Property>
  <Property name="checkboxModelKey" type="string">
    The base model key for checkbox state management. Checkbox states are stored
    in an object at `stateKey + '_checks'` unless individual items specify their
    own modelKey.
  </Property>
  <Property name="closeOnSelect" type="string | boolean">
    Controls whether the dropdown menu closes when an item is clicked. Accepts
    "true", "1", "on", "yes", true, or empty string for true. Any other value is
    false. Default is true (empty string).
  </Property>
  <Property name="windowIndex" type="number">
    Index of the window in the BetterForms window stack. Used for multi-window
    applications to access the correct model state. Default is 0.
  </Property>
</Properties>

---

## Item Types Guide

The Dropdown component supports five different item types, each serving a specific purpose in your menu structure.

### Item Type Overview

**Interactive Items:**

- **`item`** - Standard clickable menu item (default type)
- **`checkbox`** - Toggle item with checkbox indicator
- **`radio`** - Single-selection item with radio indicator

**Organizational Elements:**

- **`group`** - Container for organizing related items with a label
- **`separator`** - Visual divider between menu sections

### Standard Item

The default item type for clickable menu options.

```json
{
  "type": "item",
  "label": "Edit Profile",
  "value": "edit",
  "icon": "fa-user-pen",
  "shortcut": "⌘E",
  "disabled": false,
  "onClick": "handleEdit"
}
```

**Properties:**

- `label` - Display text (required)
- `value` - Item value passed to onClick handler
- `icon` - Font Awesome icon class
- `shortcut` - Keyboard shortcut hint (display only)
- `disabled` - Boolean to disable the item
- `onClick` - Named action to trigger. Can be:
  - String: `"myAction"` (just the action name)
  - Object: `{ "namedAction": "myAction", "actionOptions": { ... } }` (action with options)

**onClick Handler:**

When an item is clicked, the named action receives an options object containing:

```javascript
{
  value: "edit",           // The item's value property
  item: { /* full item */ }, // The complete item object
  // Plus any custom properties from actionOptions
}
```

**Example:**

```javascript
// Item configuration
{
  "label": "Edit Profile",
  "value": "editProfile",
  "onClick": {
    "namedAction": "handleAction",
    "actionOptions": { "mode": "edit", "section": "profile" }
  }
}

// Your named action handler
function handleAction(options) {
  console.log(options.value)   // "editProfile"
  console.log(options.mode)    // "edit"
  console.log(options.section) // "profile"
  console.log(options.item)    // { label: "Edit Profile", value: "editProfile", ... }
}
```

### Checkbox Item

Toggle items that maintain independent checked/unchecked states.

```json
{
  "type": "checkbox",
  "label": "Show Deleted",
  "value": "showDeleted",
  "icon": "fa-eye-slash",
  "modelKey": "filters.showDeleted",
  "disabled": false,
  "onClick": "updateFilters"
}
```

**Properties:**

- Same as standard item, plus:
- `modelKey` - Optional model path for checkbox state. If not provided, state is stored in the internal checks object using the `value` as the key.

**State Management:**

- Without `modelKey`: State stored at `model[stateKey + '_checks'][value]`
- With `modelKey`: State stored at `model[modelKey]`

### Radio Item

Single-selection items where only one can be active at a time.

```json
{
  "type": "radio",
  "label": "Sort by Name",
  "value": "name",
  "icon": "fa-arrow-down-a-z",
  "disabled": false,
  "onClick": "updateSort"
}
```

**Properties:**

- Same as standard item
- All radio items in the same dropdown share the `modelKey` specified at the dropdown level
- Selecting a radio item automatically closes the dropdown

**State Management:**

- Selected value stored at `model[modelKey]` (dropdown-level property)
- Only one radio item can be selected at a time

### Group

Organizes related items under a labeled section.

```json
{
  "type": "group",
  "label": "Actions",
  "items": [
    {
      "label": "Edit",
      "value": "edit",
      "icon": "fa-pen",
      "onClick": "handleEdit"
    },
    {
      "label": "Duplicate",
      "value": "duplicate",
      "icon": "fa-copy",
      "onClick": "handleDuplicate"
    },
    {
      "label": "Delete",
      "value": "delete",
      "icon": "fa-trash",
      "onClick": "handleDelete"
    }
  ]
}
```

**Properties:**

- `label` - Group header text
- `items` - Array of items (item, checkbox, or radio types)

**Notes:**

- Groups cannot be nested
- Group labels are styled with smaller, muted text
- Separator items within groups are supported

### Separator

Visual divider for organizing menu sections.

```json
{
  "type": "separator"
}
```

**Properties:**

- No additional properties required

**Usage:**

- Place between groups or items to create visual separation
- Renders as a horizontal line with appropriate spacing

---

## Choosing the Right Item Type

Select item types based on the interaction pattern you need.

**By Interaction Pattern:**

- **Standard Items** - Use for actions or navigation (e.g., "Edit", "Delete", "View Details")
- **Checkboxes** - Use for independent toggles that can be on/off simultaneously (e.g., filters, preferences)
- **Radio Items** - Use for mutually exclusive options (e.g., sort order, view mode, status filter)
- **Groups** - Use to organize related items under a category
- **Separators** - Use to visually divide different sections of the menu

**By Use Case:**

**Actions Menu:**

- Standard items for primary actions
- Separators between action groups
- Group for related actions

**Settings/Filters:**

- Checkboxes for multiple independent settings
- Radio items for single-choice options
- Groups to organize by category

**Context Menu:**

- Standard items for quick actions
- Separators between action types
- Disabled items for unavailable actions

**Real-World Examples:**

**User Menu:**

```json
{
  "items": [
    {
      "label": "Profile",
      "value": "profile",
      "icon": "fa-user",
      "onClick": "viewProfile"
    },
    {
      "label": "Settings",
      "value": "settings",
      "icon": "fa-cog",
      "onClick": "openSettings"
    },
    { "type": "separator" },
    {
      "label": "Sign Out",
      "value": "signout",
      "icon": "fa-sign-out",
      "onClick": "signOut"
    }
  ]
}
```

**Filter Menu:**

```json
{
  "items": [
    {
      "type": "group",
      "label": "Status",
      "items": [
        { "type": "checkbox", "label": "Active", "value": "active" },
        { "type": "checkbox", "label": "Pending", "value": "pending" },
        { "type": "checkbox", "label": "Completed", "value": "completed" }
      ]
    },
    { "type": "separator" },
    {
      "type": "group",
      "label": "Sort By",
      "items": [
        { "type": "radio", "label": "Name", "value": "name" },
        { "type": "radio", "label": "Date", "value": "date" },
        { "type": "radio", "label": "Priority", "value": "priority" }
      ]
    }
  ]
}
```

**Best Practices:**

**✅ Do:**

- Use groups to organize more than 5 items
- Add icons to improve scannability
- Use separators to create logical sections
- Provide clear, action-oriented labels
- Set disabled state for unavailable actions

**❌ Don't:**

- Nest groups within groups
- Mix radio items across multiple groups (use separate dropdowns)
- Create dropdowns with more than 15-20 items (consider alternatives)
- Use overly long labels that wrap multiple lines

---

## Usage Examples

The Dropdown component can be used in two ways: as JSON configuration objects or as HTML `<bfcomp>` elements. Both approaches provide the same functionality.

### Basic Dropdown

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Actions" 
        :items="model.actionsMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.actionsMenuItems = [
  { label: 'Edit', value: 'edit', onClick: 'handleEdit' },
  { label: 'Delete', value: 'delete', onClick: 'handleDelete' },
]
```

```json title="JSON Configuration"
{
  "label": "Actions",
  "items": [
    { "label": "Edit", "value": "edit", "onClick": "handleEdit" },
    { "label": "Delete", "value": "delete", "onClick": "handleDelete" }
  ]
}
```

</CodeGroup>

### Dropdown with Icons

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Menu" 
        icon="fa-bars"
        :items="model.mainMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.mainMenuItems = [
  { label: 'New', icon: 'fa-plus', onClick: 'createNew' },
  { label: 'Save', icon: 'fa-floppy-disk', onClick: 'save' },
  { type: 'separator' },
  { label: 'Export', icon: 'fa-download', onClick: 'export' },
]
```

```json title="JSON Configuration"
{
  "label": "Menu",
  "icon": "fa-bars",
  "items": [
    { "label": "New", "icon": "fa-plus", "onClick": "createNew" },
    { "label": "Save", "icon": "fa-floppy-disk", "onClick": "save" },
    { "type": "separator" },
    { "label": "Export", "icon": "fa-download", "onClick": "export" }
  ]
}
```

</CodeGroup>

### Dropdown with Checkboxes

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Filters" 
        stateKey="filterMenuOpen"
        :items="model.filterMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.filterMenuItems = [
  {
    type: 'checkbox',
    label: 'Active',
    value: 'active',
    onClick: 'updateFilter',
  },
  {
    type: 'checkbox',
    label: 'Pending',
    value: 'pending',
    onClick: 'updateFilter',
  },
  {
    type: 'checkbox',
    label: 'Completed',
    value: 'completed',
    onClick: 'updateFilter',
  },
]
```

```json title="JSON Configuration"
{
  "label": "Filters",
  "stateKey": "filterMenuOpen",
  "items": [
    {
      "type": "checkbox",
      "label": "Active",
      "value": "active",
      "onClick": "updateFilter"
    },
    {
      "type": "checkbox",
      "label": "Pending",
      "value": "pending",
      "onClick": "updateFilter"
    },
    {
      "type": "checkbox",
      "label": "Completed",
      "value": "completed",
      "onClick": "updateFilter"
    }
  ]
}
```

</CodeGroup>

### Dropdown with Radio Items

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Sort By" 
        modelKey="sortField"
        :items="model.sortMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.sortMenuItems = [
  { type: 'radio', label: 'Name', value: 'name', onClick: 'updateSort' },
  {
    type: 'radio',
    label: 'Date Created',
    value: 'created',
    onClick: 'updateSort',
  },
  {
    type: 'radio',
    label: 'Date Modified',
    value: 'modified',
    onClick: 'updateSort',
  },
]
```

```json title="JSON Configuration"
{
  "label": "Sort By",
  "modelKey": "sortField",
  "items": [
    {
      "type": "radio",
      "label": "Name",
      "value": "name",
      "onClick": "updateSort"
    },
    {
      "type": "radio",
      "label": "Date Created",
      "value": "created",
      "onClick": "updateSort"
    },
    {
      "type": "radio",
      "label": "Date Modified",
      "value": "modified",
      "onClick": "updateSort"
    }
  ]
}
```

</CodeGroup>

### Dropdown with Groups

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Options" 
        :items="model.groupedMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.groupedMenuItems = [
  {
    type: 'group',
    label: 'File Actions',
    items: [
      { label: 'New File', icon: 'fa-file', onClick: 'newFile' },
      { label: 'Open File', icon: 'fa-folder-open', onClick: 'openFile' },
    ],
  },
  { type: 'separator' },
  {
    type: 'group',
    label: 'Edit Actions',
    items: [
      { label: 'Cut', icon: 'fa-scissors', shortcut: '⌘X', onClick: 'cut' },
      { label: 'Copy', icon: 'fa-copy', shortcut: '⌘C', onClick: 'copy' },
      { label: 'Paste', icon: 'fa-paste', shortcut: '⌘V', onClick: 'paste' },
    ],
  },
]
```

```json title="JSON Configuration"
{
  "label": "Options",
  "items": [
    {
      "type": "group",
      "label": "File Actions",
      "items": [
        { "label": "New File", "icon": "fa-file", "onClick": "newFile" },
        {
          "label": "Open File",
          "icon": "fa-folder-open",
          "onClick": "openFile"
        }
      ]
    },
    { "type": "separator" },
    {
      "type": "group",
      "label": "Edit Actions",
      "items": [
        {
          "label": "Cut",
          "icon": "fa-scissors",
          "shortcut": "⌘X",
          "onClick": "cut"
        },
        {
          "label": "Copy",
          "icon": "fa-copy",
          "shortcut": "⌘C",
          "onClick": "copy"
        },
        {
          "label": "Paste",
          "icon": "fa-paste",
          "shortcut": "⌘V",
          "onClick": "paste"
        }
      ]
    }
  ]
}
```

</CodeGroup>

### Dropdown with Disabled Items

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Edit" 
        :items="model.editMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.editMenuItems = [
  { label: 'Undo', icon: 'fa-rotate-left', disabled: true },
  { label: 'Redo', icon: 'fa-rotate-right', disabled: true },
  { type: 'separator' },
  { label: 'Cut', icon: 'fa-scissors', onClick: 'cut' },
  { label: 'Copy', icon: 'fa-copy', onClick: 'copy' },
]
```

```json title="JSON Configuration"
{
  "label": "Edit",
  "items": [
    { "label": "Undo", "icon": "fa-rotate-left", "disabled": true },
    { "label": "Redo", "icon": "fa-rotate-right", "disabled": true },
    { "type": "separator" },
    { "label": "Cut", "icon": "fa-scissors", "onClick": "cut" },
    { "label": "Copy", "icon": "fa-copy", "onClick": "copy" }
  ]
}
```

</CodeGroup>

### Dropdown with Custom Alignment

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="User Menu" 
        align="start"
        icon="fa-user-circle"
        :items="model.userMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.userMenuItems = [
  { label: 'Profile', icon: 'fa-user', onClick: 'viewProfile' },
  { label: 'Settings', icon: 'fa-cog', onClick: 'openSettings' },
  { type: 'separator' },
  { label: 'Sign Out', icon: 'fa-sign-out', onClick: 'signOut' },
]
```

```json title="JSON Configuration"
{
  "label": "User Menu",
  "align": "start",
  "icon": "fa-user-circle",
  "items": [
    { "label": "Profile", "icon": "fa-user", "onClick": "viewProfile" },
    { "label": "Settings", "icon": "fa-cog", "onClick": "openSettings" },
    { "type": "separator" },
    { "label": "Sign Out", "icon": "fa-sign-out", "onClick": "signOut" }
  ]
}
```

</CodeGroup>

### Full Width Dropdown

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Select Action" 
        fullWidth="true"
        :items="model.exportMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.exportMenuItems = [
  { label: 'Export to PDF', icon: 'fa-file-pdf', onClick: 'exportPDF' },
  { label: 'Export to CSV', icon: 'fa-file-csv', onClick: 'exportCSV' },
  { label: 'Export to Excel', icon: 'fa-file-excel', onClick: 'exportExcel' },
]
```

```json title="JSON Configuration"
{
  "label": "Select Action",
  "fullWidth": true,
  "items": [
    { "label": "Export to PDF", "icon": "fa-file-pdf", "onClick": "exportPDF" },
    { "label": "Export to CSV", "icon": "fa-file-csv", "onClick": "exportCSV" },
    {
      "label": "Export to Excel",
      "icon": "fa-file-excel",
      "onClick": "exportExcel"
    }
  ]
}
```

</CodeGroup>

### Dropdown with Action Options

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Share" 
        icon="fa-share-nodes"
        :items="model.shareMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.shareMenuItems = [
  {
    label: 'Email',
    icon: 'fa-envelope',
    onClick: {
      namedAction: 'shareContent',
      actionOptions: { method: 'email' },
    },
  },
  {
    label: 'Copy Link',
    icon: 'fa-link',
    onClick: {
      namedAction: 'shareContent',
      actionOptions: { method: 'link' },
    },
  },
]
```

```json title="JSON Configuration"
{
  "label": "Share",
  "icon": "fa-share-nodes",
  "items": [
    {
      "label": "Email",
      "icon": "fa-envelope",
      "onClick": {
        "namedAction": "shareContent",
        "actionOptions": { "method": "email" }
      }
    },
    {
      "label": "Copy Link",
      "icon": "fa-link",
      "onClick": {
        "namedAction": "shareContent",
        "actionOptions": { "method": "link" }
      }
    }
  ]
}
```

</CodeGroup>

### Grouped Items with Action Options

<CodeGroup>
```html title="HTML Component"
<bfcomp name="Dropdown" 
        label="Add Role" 
        icon="fa-user-plus"
        :items="model.roleMenuItems">
</bfcomp>
```

```javascript title="Model Definition"
// Define items in your model
model.roleMenuItems = [
  {
    type: 'group',
    label: 'Available Roles',
    items: [
      {
        label: 'Claimant',
        value: 'claimant',
        icon: 'fa-user',
        onClick: {
          namedAction: 'addRole',
          actionOptions: { role: 'claimant' },
        },
      },
      {
        label: 'Attorney',
        value: 'attorney',
        icon: 'fa-gavel',
        onClick: {
          namedAction: 'addRole',
          actionOptions: { role: 'attorney' },
        },
      },
      {
        label: 'Defense Firm',
        value: 'defenseFirm',
        icon: 'fa-building',
        disabled: true,
        onClick: {
          namedAction: 'addRole',
          actionOptions: { role: 'defenseFirm' },
        },
      },
    ],
  },
]
```

```json title="JSON Configuration"
{
  "label": "Add Role",
  "icon": "fa-user-plus",
  "items": [
    {
      "type": "group",
      "label": "Available Roles",
      "items": [
        {
          "label": "Claimant",
          "value": "claimant",
          "icon": "fa-user",
          "onClick": {
            "namedAction": "addRole",
            "actionOptions": { "role": "claimant" }
          }
        },
        {
          "label": "Attorney",
          "value": "attorney",
          "icon": "fa-gavel",
          "onClick": {
            "namedAction": "addRole",
            "actionOptions": { "role": "attorney" }
          }
        },
        {
          "label": "Defense Firm",
          "value": "defenseFirm",
          "icon": "fa-building",
          "disabled": true,
          "onClick": {
            "namedAction": "addRole",
            "actionOptions": { "role": "defenseFirm" }
          }
        }
      ]
    }
  ]
}
```

</CodeGroup>

---

## Component Schema

The complete component schema for the Dropdown component. Copy and paste this code into the Component Schema section of your BetterForms app.

### Complete Schema

<CodeGroup>
```json title="Component Schema"
{
    "checkboxModelKey": "dropdownChecks",
    "closeOnSelect": "",
    "html": "<!-- DROPDOWN (BetterForms) -->\n<div\n  class=\"relative inline-block text-left\"\n  :class=\"(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (v==='true'||v==='1'||v==='on'||v==='yes') ? 'w-full' : 'w-fit'; })(schema.fullWidth)\"\n>\n  <!-- Init -->\n  <script>\n    (function(){\n      try{\n        var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];\n        var m   = win.formSchema.model || {};\n        var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n        if (typeof m[sk] === 'undefined') m[sk] = false;\n        var ck  = sk + '_checks';\n        if (!m[ck]) m[ck] = {};\n        win.formSchema.model = m;\n      }catch(_){}\n    })();\n  </script>\n\n  <!-- Trigger -->\n  <button\n    type=\"button\"\n    :id=\"(schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default')\"\n    :aria-haspopup=\"'menu'\"\n    :aria-expanded=\"(function(){\n      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n      return !!m[sk] ? 'true' : 'false';\n    })()\"\n    @click=\"(function(){\n      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n      m[sk] = !m[sk];\n    })()\"\n    @keydown.escape.stop.prevent=\"(function(){\n      var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');\n      var el = document.getElementById(id); if (el) el.focus();\n      var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n      var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n      m[sk] = false;\n    })()\"\n    class=\"inline-flex items-center gap-2 rounded-md border border-input bg-background px-3 py-2 text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground focus:outline-none\"\n  >\n    <i v-if=\"schema.icon\" class=\"fa-regular text-[12px]\" :class=\"schema.icon\"></i>\n    <span>{{ schema.label || 'Open Menu' }}</span>\n    <i class=\"fa-regular fa-chevron-down text-[12px]\"></i>\n  </button>\n\n  <!-- Menu -->\n  <div\n    class=\"absolute z-50 mt-2 min-w-48 max-w-[calc(100vw-1rem)] rounded-md border border-border bg-popover text-popover-foreground shadow focus:outline-none\"\n    :class=\"(function(a){\n      if (a==='start')  return 'left-0 right-auto origin-top-left';\n      if (a==='center') return 'left-1/2 -translate-x-1/2 origin-top';\n      return 'right-0 left-auto origin-top-right';\n    })(schema.align)\"\n    role=\"menu\"\n    :aria-hidden=\"(function(){\n      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n      return !!m[sk] ? 'false' : 'true';\n    })()\"\n    :style=\"(function(){\n      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n      return (!!m[sk]) ? '' : 'display:none;';\n    })()\"\n    @keydown.escape.stop.prevent=\"(function(){\n      var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');\n      var el = document.getElementById(id); if (el) el.focus();\n      var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n      var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n      m[sk] = false;\n    })()\"\n  >\n    <div class=\"py-1\" role=\"none\">\n      <!-- Top-level loop -->\n      <template\n        v-for=\"(it, idx) in (function(){\n          try { return Array.isArray(schema.items) ? schema.items : (typeof schema.items==='string' ? JSON.parse(schema.items) : []); }\n          catch(_) { return []; }\n        })()\"\n        :key=\"'top-'+idx\"\n      >\n        <!-- GROUP: label + children -->\n        <div v-if=\"(it.type==='group')\" role=\"group\" aria-label=\"Group\">\n          <div class=\"px-2 pb-1 pt-2 text-xs font-semibold text-muted-foreground\" role=\"presentation\">\n            {{ it.label || '' }}\n          </div>\n\n          <!-- children -->\n          <template v-for=\"(node, nidx) in (Array.isArray(it.items) ? it.items : [])\" :key=\"'g-'+idx+'-'+nidx\">\n            <!-- Default item -->\n            <button\n              v-if=\"(!node.type || node.type==='item')\"\n              type=\"button\" role=\"menuitem\"\n              :disabled=\"(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)\"\n              @click=\"(function(){\n                if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)) return;\n\n                var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];\n                var m   = win.formSchema.model || {};\n                var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n\n                var cos   = schema.closeOnSelect;\n                var close = (cos===true) || ['true','1','on','yes',''].includes(((cos??'')+'').toLowerCase());\n                if (close) {\n                  var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');\n                  var el = document.getElementById(id); if (el) el.focus();\n                  m[sk] = false;\n                }\n\n                var act = node.onClick;\n                var name='', opts={};\n                if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }\n                else { name=(act||'').toString().trim(); }\n                if (name){\n                  opts = Object.assign({ value: node.value, item: node }, opts);\n                  if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);\n                  else if (typeof namedAction!=='undefined')     namedAction(name, opts);\n                }\n              })()\"\n              class=\"flex w-full items-center gap-2 p-2 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none\"\n            >\n              <i v-if=\"node.icon\" class=\"fa-regular text-[12px]\" :class=\"node.icon\"></i>\n              <span class=\"flex-1 text-left\">{{ node.label || node.value || ('Item ' + (nidx+1)) }}</span>\n              <span v-if=\"node.shortcut\" class=\"text-xs text-muted-foreground\">{{ node.shortcut }}</span>\n            </button>\n\n            <!-- Checkbox item -->\n            <button\n              v-else-if=\"(node.type==='checkbox')\"\n              type=\"button\" role=\"menuitemcheckbox\"\n              :aria-checked=\"(function(){\n                var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n                var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n                var ck = sk + '_checks';\n                return (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value])) ? 'true' : 'false';\n              })()\"\n              :disabled=\"(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)\"\n              @click=\"(function(){\n                if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)) return;\n\n                var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];\n                var m   = win.formSchema.model || {};\n                var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n                var ck  = sk + '_checks';\n\n                if (node.modelKey) m[node.modelKey] = !m[node.modelKey];\n                else { if (!m[ck]) m[ck] = {}; m[ck][node.value] = !m[ck][node.value]; }\n\n                var act = node.onClick;\n                var name='', opts={};\n                if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }\n                else { name=(act||'').toString().trim(); }\n                if (name){\n                  var checked = (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value]));\n                  opts = Object.assign({ value: node.value, checked: checked, item: node }, opts);\n                  if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);\n                  else if (typeof namedAction!=='undefined')     namedAction(name, opts);\n                }\n              })()\"\n              class=\"flex w-full items-center gap-2 px-2 py-1.5 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none\"\n            >\n              <i v-if=\"node.icon\" class=\"fa-regular text-[12px]\" :class=\"node.icon\"></i>\n              <span class=\"inline-flex h-3.5 w-3.5 items-center justify-center rounded border border-input bg-background text-[10px]\"\n                    :class=\"(function(){\n                      var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n                      var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n                      var ck = sk + '_checks';\n                      var on = (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value]));\n                      return on ? 'bg-primary border-primary text-primary-foreground' : '';\n                    })()\">\n                <i class=\"fa-regular fa-check\" v-if=\"(function(){\n                  var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n                  var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n                  var ck = sk + '_checks';\n                  return (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value]));\n                })()\"></i>\n              </span>\n              <span class=\"flex-1 text-left\">{{ node.label || node.value || ('Item ' + (nidx+1)) }}</span>\n            </button>\n\n            <!-- Radio item -->\n            <button\n              v-else-if=\"(node.type==='radio')\"\n              type=\"button\" role=\"menuitemradio\"\n              :aria-checked=\"(function(){\n                var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n                var k = (schema.modelKey || 'dropdownRadio');\n                return (m[k] === node.value) ? 'true' : 'false';\n              })()\"\n              :disabled=\"(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)\"\n              @click=\"(function(){\n                if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)) return;\n\n                var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];\n                var m   = win.formSchema.model || {};\n                var k   = (schema.modelKey || 'dropdownRadio');\n                m[k]    = node.value;\n\n                var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n                var id  = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');\n                var el  = document.getElementById(id); if (el) el.focus();\n                m[sk] = false;\n\n                var act = node.onClick;\n                var name='', opts={};\n                if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }\n                else { name=(act||'').toString().trim(); }\n                if (name){\n                  opts = Object.assign({ value: node.value, item: node }, opts);\n                  if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);\n                  else if (typeof namedAction!=='undefined')     namedAction(name, opts);\n                }\n              })()\"\n              class=\"flex w-full items-center gap-2 px-2 py-1.5 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none\"\n            >\n              <i v-if=\"node.icon\" class=\"fa-regular text-[12px]\" :class=\"node.icon\"></i>\n              <span class=\"inline-flex h-3.5 w-3.5 items-center justify-center rounded-full border border-input bg-background\"\n                    :class=\"(function(){\n                      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n                      var k = (schema.modelKey || 'dropdownRadio');\n                      return (m[k] === node.value) ? 'border-primary' : '';\n                    })()\">\n                <span class=\"h-2 w-2 rounded-full\"\n                      :class=\"(function(){\n                        var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n                        var k = (schema.modelKey || 'dropdownRadio');\n                        return (m[k] === node.value) ? 'bg-primary' : 'bg-transparent';\n                      })()\"></span>\n              </span>\n              <span class=\"flex-1 text-left\">{{ node.label || node.value || ('Item ' + (nidx+1)) }}</span>\n            </button>\n          </template>\n        </div>\n\n        <!-- SEPARATOR at top level -->\n        <div v-else-if=\"(it.type==='separator')\" class=\"my-1 border-t border-border\" role=\"separator\" aria-orientation=\"horizontal\"></div>\n\n        <!-- TOP-LEVEL ITEM (if not grouped) -->\n        <button\n          v-else\n          type=\"button\" role=\"menuitem\"\n          :disabled=\"(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (it.disabled===true)||['true','1','on','yes'].includes(v); })(it.disabled)\"\n          @click=\"(function(){\n            if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (it.disabled===true)||['true','1','on','yes'].includes(v); })(it.disabled)) return;\n\n            var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};\n            var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));\n            var cos   = schema.closeOnSelect;\n            var close = (cos===true) || ['true','1','on','yes',''].includes(((cos??'')+'').toLowerCase());\n            if (close) {\n              var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');\n              var el = document.getElementById(id); if (el) el.focus();\n              m[sk] = false;\n            }\n\n            var act = it.onClick;\n            var name='', opts={};\n            if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }\n            else { name=(act||'').toString().trim(); }\n            if (name){\n              opts = Object.assign({ value: it.value, item: it }, opts);\n              if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);\n              else if (typeof namedAction!=='undefined')     namedAction(name, opts);\n            }\n          })()\"\n          class=\"flex w-full items-center gap-2 px-2 py-1.5 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none\"\n        >\n          <i v-if=\"it.icon\" class=\"fa-regular text-[12px]\" :class=\"it.icon\"></i>\n          <span class=\"flex-1 text-left\">{{ it.label || it.value || ('Item ' + (idx+1)) }}</span>\n          <span v-if=\"it.shortcut\" class=\"text-xs text-muted-foreground\">{{ it.shortcut }}</span>\n        </button>\n      </template>\n    </div>\n  </div>\n</div>",
    "icon": "",
    "items": [],
    "label": "Open menu",
    "modelKey": "",
    "radioModelKey": "dropdownRadio",
    "stateKey": "dropdownOpen",
    "windowIndex": 0
}
```

```html title="HTML Template"
<!-- DROPDOWN (BetterForms) -->
<div
  class="relative inline-block text-left"
  :class="(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (v==='true'||v==='1'||v==='on'||v==='yes') ? 'w-full' : 'w-fit'; })(schema.fullWidth)"
>
  <!-- Init -->
  <script>
    (function(){
      try{
        var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];
        var m   = win.formSchema.model || {};
        var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
        if (typeof m[sk] === 'undefined') m[sk] = false;
        var ck  = sk + '_checks';
        if (!m[ck]) m[ck] = {};
        win.formSchema.model = m;
      }catch(_){}
    })();
  </script>

  <!-- Trigger -->
  <button
    type="button"
    :id="(schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default')"
    :aria-haspopup="'menu'"
    :aria-expanded="(function(){
      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
      return !!m[sk] ? 'true' : 'false';
    })()"
    @click="(function(){
      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
      m[sk] = !m[sk];
    })()"
    @keydown.escape.stop.prevent="(function(){
      var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');
      var el = document.getElementById(id); if (el) el.focus();
      var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
      var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
      m[sk] = false;
    })()"
    class="inline-flex items-center gap-2 rounded-md border border-input bg-background px-3 py-2 text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground focus:outline-none"
  >
    <i v-if="schema.icon" class="fa-regular text-[12px]" :class="schema.icon"></i>
    <span>{{ schema.label || 'Open Menu' }}</span>
    <i class="fa-regular fa-chevron-down text-[12px]"></i>
  </button>

  <!-- Menu -->
  <div
    class="absolute z-50 mt-2 min-w-48 max-w-[calc(100vw-1rem)] rounded-md border border-border bg-popover text-popover-foreground shadow focus:outline-none"
    :class="(function(a){
      if (a==='start')  return 'left-0 right-auto origin-top-left';
      if (a==='center') return 'left-1/2 -translate-x-1/2 origin-top';
      return 'right-0 left-auto origin-top-right';
    })(schema.align)"
    role="menu"
    :aria-hidden="(function(){
      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
      return !!m[sk] ? 'false' : 'true';
    })()"
    :style="(function(){
      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
      var sk= (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
      return (!!m[sk]) ? '' : 'display:none;';
    })()"
    @keydown.escape.stop.prevent="(function(){
      var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');
      var el = document.getElementById(id); if (el) el.focus();
      var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
      var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
      m[sk] = false;
    })()"
  >
    <div class="py-1" role="none">
      <!-- Top-level loop -->
      <template
        v-for="(it, idx) in (function(){
          try { return Array.isArray(schema.items) ? schema.items : (typeof schema.items==='string' ? JSON.parse(schema.items) : []); }
          catch(_) { return []; }
        })()"
        :key="'top-'+idx"
      >
        <!-- GROUP: label + children -->
        <div v-if="(it.type==='group')" role="group" aria-label="Group">
          <div class="px-2 pb-1 pt-2 text-xs font-semibold text-muted-foreground" role="presentation">
            {{ it.label || '' }}
          </div>

          <!-- children -->
          <template v-for="(node, nidx) in (Array.isArray(it.items) ? it.items : [])" :key="'g-'+idx+'-'+nidx">
            <!-- Default item -->
            <button
              v-if="(!node.type || node.type==='item')"
              type="button" role="menuitem"
              :disabled="(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)"
              @click="(function(){
                if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)) return;

                var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];
                var m   = win.formSchema.model || {};
                var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));

                var cos   = schema.closeOnSelect;
                var close = (cos===true) || ['true','1','on','yes',''].includes(((cos??'')+'').toLowerCase());
                if (close) {
                  var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');
                  var el = document.getElementById(id); if (el) el.focus();
                  m[sk] = false;
                }

                var act = node.onClick;
                var name='', opts={};
                if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }
                else { name=(act||'').toString().trim(); }
                if (name){
                  opts = Object.assign({ value: node.value, item: node }, opts);
                  if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);
                  else if (typeof namedAction!=='undefined')     namedAction(name, opts);
                }
              })()"
              class="flex w-full items-center gap-2 p-2 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none"
            >
              <i v-if="node.icon" class="fa-regular text-[12px]" :class="node.icon"></i>
              <span class="flex-1 text-left">{{ node.label || node.value || ('Item ' + (nidx+1)) }}</span>
              <span v-if="node.shortcut" class="text-xs text-muted-foreground">{{ node.shortcut }}</span>
            </button>

            <!-- Checkbox item -->
            <button
              v-else-if="(node.type==='checkbox')"
              type="button" role="menuitemcheckbox"
              :aria-checked="(function(){
                var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
                var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
                var ck = sk + '_checks';
                return (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value])) ? 'true' : 'false';
              })()"
              :disabled="(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)"
              @click="(function(){
                if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)) return;

                var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];
                var m   = win.formSchema.model || {};
                var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
                var ck  = sk + '_checks';

                if (node.modelKey) m[node.modelKey] = !m[node.modelKey];
                else { if (!m[ck]) m[ck] = {}; m[ck][node.value] = !m[ck][node.value]; }

                var act = node.onClick;
                var name='', opts={};
                if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }
                else { name=(act||'').toString().trim(); }
                if (name){
                  var checked = (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value]));
                  opts = Object.assign({ value: node.value, checked: checked, item: node }, opts);
                  if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);
                  else if (typeof namedAction!=='undefined')     namedAction(name, opts);
                }
              })()"
              class="flex w-full items-center gap-2 px-2 py-1.5 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none"
            >
              <i v-if="node.icon" class="fa-regular text-[12px]" :class="node.icon"></i>
              <span class="inline-flex h-3.5 w-3.5 items-center justify-center rounded border border-input bg-background text-[10px]"
                    :class="(function(){
                      var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
                      var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
                      var ck = sk + '_checks';
                      var on = (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value]));
                      return on ? 'bg-primary border-primary text-primary-foreground' : '';
                    })()">
                <i class="fa-regular fa-check" v-if="(function(){
                  var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
                  var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
                  var ck = sk + '_checks';
                  return (node.modelKey ? !!m[node.modelKey] : !!(m[ck] && m[ck][node.value]));
                })()"></i>
              </span>
              <span class="flex-1 text-left">{{ node.label || node.value || ('Item ' + (nidx+1)) }}</span>
            </button>

            <!-- Radio item -->
            <button
              v-else-if="(node.type==='radio')"
              type="button" role="menuitemradio"
              :aria-checked="(function(){
                var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
                var k = (schema.modelKey || 'dropdownRadio');
                return (m[k] === node.value) ? 'true' : 'false';
              })()"
              :disabled="(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)"
              @click="(function(){
                if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (node.disabled===true)||['true','1','on','yes'].includes(v); })(node.disabled)) return;

                var win = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)];
                var m   = win.formSchema.model || {};
                var k   = (schema.modelKey || 'dropdownRadio');
                m[k]    = node.value;

                var sk  = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
                var id  = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');
                var el  = document.getElementById(id); if (el) el.focus();
                m[sk] = false;

                var act = node.onClick;
                var name='', opts={};
                if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }
                else { name=(act||'').toString().trim(); }
                if (name){
                  opts = Object.assign({ value: node.value, item: node }, opts);
                  if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);
                  else if (typeof namedAction!=='undefined')     namedAction(name, opts);
                }
              })()"
              class="flex w-full items-center gap-2 px-2 py-1.5 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none"
            >
              <i v-if="node.icon" class="fa-regular text-[12px]" :class="node.icon"></i>
              <span class="inline-flex h-3.5 w-3.5 items-center justify-center rounded-full border border-input bg-background"
                    :class="(function(){
                      var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
                      var k = (schema.modelKey || 'dropdownRadio');
                      return (m[k] === node.value) ? 'border-primary' : '';
                    })()">
                <span class="h-2 w-2 rounded-full"
                      :class="(function(){
                        var m = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
                        var k = (schema.modelKey || 'dropdownRadio');
                        return (m[k] === node.value) ? 'bg-primary' : 'bg-transparent';
                      })()"></span>
              </span>
              <span class="flex-1 text-left">{{ node.label || node.value || ('Item ' + (nidx+1)) }}</span>
            </button>
          </template>
        </div>

        <!-- SEPARATOR at top level -->
        <div v-else-if="(it.type==='separator')" class="my-1 border-t border-border" role="separator" aria-orientation="horizontal"></div>

        <!-- TOP-LEVEL ITEM (if not grouped) -->
        <button
          v-else
          type="button" role="menuitem"
          :disabled="(function(v){ v=(v??'')+''; v=v.toLowerCase(); return (it.disabled===true)||['true','1','on','yes'].includes(v); })(it.disabled)"
          @click="(function(){
            if ((function(v){ v=(v??'')+''; v=v.toLowerCase(); return (it.disabled===true)||['true','1','on','yes'].includes(v); })(it.disabled)) return;

            var m  = vueapp.$store.state.wndw.windows[(schema.windowIndex ?? 0)].formSchema.model || {};
            var sk = (schema.stateKey && (schema.stateKey+'').trim()) || ('dropdownState_' + (schema.modelKey || 'default'));
            var cos   = schema.closeOnSelect;
            var close = (cos===true) || ['true','1','on','yes',''].includes(((cos??'')+'').toLowerCase());
            if (close) {
              var id = (schema.idPrefix || 'dd') + '-btn-' + (schema.modelKey || 'default');
              var el = document.getElementById(id); if (el) el.focus();
              m[sk] = false;
            }

            var act = it.onClick;
            var name='', opts={};
            if (act && typeof act==='object'){ name=(act.namedAction||'').toString().trim(); opts=act.actionOptions||{}; }
            else { name=(act||'').toString().trim(); }
            if (name){
              opts = Object.assign({ value: it.value, item: it }, opts);
              if (typeof BF!=='undefined' && BF.namedAction) BF.namedAction(name, opts);
              else if (typeof namedAction!=='undefined')     namedAction(name, opts);
            }
          })()"
          class="flex w-full items-center gap-2 px-2 py-1.5 text-sm text-foreground hover:bg-accent hover:text-accent-foreground disabled:opacity-50 disabled:pointer-events-none"
        >
          <i v-if="it.icon" class="fa-regular text-[12px]" :class="it.icon"></i>
          <span class="flex-1 text-left">{{ it.label || it.value || ('Item ' + (idx+1)) }}</span>
          <span v-if="it.shortcut" class="text-xs text-muted-foreground">{{ it.shortcut }}</span>
        </button>
      </template>
    </div>
  </div>
</div>
```
</CodeGroup>

### How to Add This Component to Your BetterForms App

1. **Navigate to Components**: In your BetterForms site environment, click the **Components** tab in the left sidebar.

2. **Create New Component**: If the Dropdown component is not already in your components list, click the **+New** button at the top left.

3. **Open Component Schema**: In the new component, click the **`</> Component Schema`** button to access the schema editor.

4. **Replace Schema Code**: Copy the complete schema from the **Component Schema** tab above and replace all the existing code in the Component Schema section.

5. **Open HTML Tab**: Click the **HTML** tab (located directly next to the Component Schema tab) to access the HTML editor.

6. **Replace HTML Code**: Copy the HTML template from the **HTML Template** tab above and replace all the existing code in the HTML section.

   **Note**: This step might feel redundant since the HTML is included as a key/value in the component schema. However, this is sometimes a quirk in BetterForms, where the HTML doesn't render properly until you manually insert the HTML in the HTML tab on the new component.

7. **Save Component**: Click the **Save** button in the top right to save the component for use in your application.

8. **Refresh Pages**: **Important**: The component will not be available for use in any live pages you are currently viewing until you manually refresh the page using your browser's Refresh button. However, the component will be immediately available in the **Page Builder** section of every page after you save and navigate away from the Components section.

### Schema Properties Reference

- **`label`**: Text displayed on the dropdown trigger button
- **`icon`**: Font Awesome icon class for the trigger button
- **`items`**: Array of menu items to display in the dropdown
- **`align`**: Horizontal alignment of the dropdown menu (start, center, end)
- **`fullWidth`**: Whether the dropdown trigger expands to full width
- **`idPrefix`**: Prefix for generating unique element IDs
- **`stateKey`**: Model key for tracking dropdown open/closed state
- **`modelKey`**: Model key for radio items to store selected value
- **`radioModelKey`**: Alternative property name for radio model key
- **`checkboxModelKey`**: Base model key for checkbox state management
- **`closeOnSelect`**: Whether dropdown closes when item is selected
- **`windowIndex`**: Window index for multi-window applications (default: 0)

---

## Dropdown Styling

The Dropdown component features a modern, accessible design with smooth animations and clear visual feedback.

### Visual Structure

The dropdown renders with the following structure:

**Trigger Button:**

- **Icon** (optional): Font Awesome icon on the left
- **Label**: Button text
- **Chevron**: Down arrow indicator on the right
- **Container**: Rounded button with border and hover effects

**Dropdown Menu:**

- **Container**: Floating popover with border and shadow
- **Items**: Clickable menu items with hover states
- **Groups**: Section headers with muted styling
- **Separators**: Horizontal dividers

### Default Appearance

```html
<!-- Trigger Button -->
<button
  class="border-input bg-background inline-flex items-center gap-2 rounded-md border px-3 py-2 text-sm font-medium"
>
  <i class="fa-regular fa-bars"></i>
  <span>Menu</span>
  <i class="fa-regular fa-chevron-down"></i>
</button>

<!-- Dropdown Menu -->
<div class="bg-popover absolute z-50 mt-2 min-w-48 rounded-md border shadow">
  <div class="py-1">
    <!-- Menu items here -->
  </div>
</div>
```

### Item States

**Normal Item:**

```html
<button
  class="hover:bg-accent flex w-full items-center gap-2 px-2 py-1.5 text-sm"
>
  <i class="fa-regular fa-pen"></i>
  <span>Edit</span>
</button>
```

**Disabled Item:**

```html
<button disabled class="pointer-events-none opacity-50">Disabled Item</button>
```

**Checkbox Item (Checked):**

```html
<button class="flex w-full items-center gap-2 px-2 py-1.5">
  <span
    class="bg-primary border-primary text-primary-foreground inline-flex h-3.5 w-3.5 items-center justify-center rounded border"
  >
    <i class="fa-regular fa-check"></i>
  </span>
  <span>Option</span>
</button>
```

**Radio Item (Selected):**

```html
<button class="flex w-full items-center gap-2 px-2 py-1.5">
  <span
    class="border-primary inline-flex h-3.5 w-3.5 items-center justify-center rounded-full border"
  >
    <span class="bg-primary h-2 w-2 rounded-full"></span>
  </span>
  <span>Selected</span>
</button>
```

**Group Header:**

```html
<div class="text-muted-foreground px-2 pt-2 pb-1 text-xs font-semibold">
  Group Label
</div>
```

**Separator:**

```html
<div class="border-border my-1 border-t"></div>
```

### Menu Alignment

The dropdown menu's position is controlled by the `align` property:

- **`align: "start"`**: `left-0 right-auto origin-top-left`
- **`align: "center"`**: `left-1/2 -translate-x-1/2 origin-top`
- **`align: "end"`**: `right-0 left-auto origin-top-right` (default)

### Animation Behavior

- **Menu appears**: Positioned absolutely below the trigger
- **Hover**: Menu items highlight with background color change
- **Keyboard navigation**: Escape key closes menu and returns focus to trigger

### Theme Integration

The component uses CSS custom properties for colors, allowing seamless integration with your application's theme:

- `bg-background`, `text-foreground` - Base colors
- `border-input`, `border-border` - Border colors
- `bg-accent`, `text-accent-foreground` - Hover states
- `bg-popover`, `text-popover-foreground` - Menu colors
- `bg-primary`, `text-primary-foreground` - Active states
- `text-muted-foreground` - Secondary text

---

## State Management

The Dropdown component provides sophisticated state management for various interaction patterns.

### Open/Close State

The dropdown automatically manages its open/closed state using the `stateKey` property.

**Default Behavior:**

```javascript
// State key defaults to: `dropdownState_${modelKey || 'default'}`
// For example, if modelKey is "sortMenu":
model.dropdownState_sortMenu = false // closed
model.dropdownState_sortMenu = true // open
```

**Custom State Key:**

```json
{
  "label": "Menu",
  "stateKey": "myCustomMenuOpen",
  "items": [...]
}
```

**Automatic Management:**

- Click trigger button → toggles state
- Click menu item → closes menu (if `closeOnSelect` is true)
- Press Escape → closes menu and returns focus to trigger
- Radio item selection → always closes menu

### Checkbox State

Checkboxes maintain independent toggle states.

**Default Checkbox Storage:**

```javascript
// Stored in an object at: `${stateKey}_checks`
// For stateKey "dropdownState_filters":
model.dropdownState_filters_checks = {
  active: true,
  pending: false,
  completed: true,
}
```

**Custom Checkbox Model:**

```json
{
  "type": "checkbox",
  "label": "Show Archived",
  "value": "archived",
  "modelKey": "filters.showArchived" // Stored at model.filters.showArchived
}
```

**Implementation Pattern:**

```javascript
// In your onClick handler
function updateFilter(options) {
  // Options passed by the component include:
  // - value: The item's value property
  // - checked: Current checkbox state (true/false)
  // - item: The full item object
  // - Plus any custom actionOptions you specified

  const { value, checked, item } = options

  // The checkbox state is already updated by the component
  // You can access it here for additional logic
  console.log(`${value} is now ${checked ? 'checked' : 'unchecked'}`)

  // Perform filtering logic
  refreshData()
}
```

### Radio State

Radio items provide mutually exclusive selection.

**Radio Storage:**

```javascript
// All radio items share the dropdown's modelKey
// For modelKey "sortField":
model.sortField = 'name' // User selected "Name"
model.sortField = 'created' // User changed to "Date Created"
```

**Configuration:**

```json
{
  "label": "Sort By",
  "modelKey": "sortField", // Shared by all radio items
  "items": [
    { "type": "radio", "label": "Name", "value": "name" },
    { "type": "radio", "label": "Date", "value": "date" }
  ]
}
```

**Implementation Pattern:**

```javascript
// In your onClick handler
function updateSort(options) {
  // Options passed by the component include:
  // - value: The selected radio item's value
  // - item: The full item object
  // - Plus any custom actionOptions you specified

  const { value, item } = options

  // The radio value is already set by the component
  // Access it for your sorting logic
  const sortField = model.sortField // = value

  // Perform sort
  sortData(sortField)
}
```

### State Initialization

The component automatically initializes required state keys when mounted:

```javascript
// Initialization logic (handled automatically)
if (typeof model[stateKey] === 'undefined') {
  model[stateKey] = false // Menu starts closed
}

if (!model[stateKey + '_checks']) {
  model[stateKey + '_checks'] = {} // Initialize checkbox storage
}
```

### Best Practices

**✅ Do:**

- Use unique `stateKey` values for each dropdown
- Use `modelKey` for checkboxes when state needs to persist across sessions
- Provide `onClick` handlers to respond to item selections
- Initialize radio `modelKey` with a default value if needed

**❌ Don't:**

- Manually manipulate checkbox states (let the component handle it)
- Reuse the same `modelKey` for different radio groups
- Mix radio items with different `modelKey` values in the same dropdown
- Forget to handle state cleanup when removing dropdowns dynamically
